Bootstrap: docker
From: multifish/spark:3.0.1-hadoop3.2
Stage: builder

%files
app_v1.jar /tmp/app/app.jar
%files from builder
/tmp/app/app.jar /app/app.jar
/buildinfo /
%post
# d2ce1280956cab48005b64a2fbb1c34ac1ab7dce20a984dff49b7c65622a60e4
# Dockerfile generated by Maru 0.1.1

# Staged build using builder container
STITCHING_SPARK_GIT_TAG=container-v1

# Checkout and build the code
mkdir -p /tmp/app
cd /tmp/app
git clone --branch ${STITCHING_SPARK_GIT_TAG} --depth 1 https://github.com/mingxiaowei/stitching-spark.git .
git submodule update --init --recursive
/usr/local/bin/buildinfo.sh
# RUN mvn package -DskipTests -X

# Find the built jar, based on the version in the pom file
# RUN xq -r '.project.artifactId+"-"+.project.version+".jar"' pom.xml > filename \
#     && mv /tmp/app/target/`cat filename` app.jar

# Create final image

mkdir -p /app
cd /app

%runscript
cd /app
exec /bin/bash "$@"
%startscript
cd /app
exec /bin/bash "$@"
